# Airport Runway Scheduling System - Integrated Build
# ====================================================

# Compiler and flags
CC = gcc
CFLAGS = -Wall -Wextra -g -O2
TARGET = airport_system

# Source files
SOURCES = main_integrated.c flight.c queue.c scheduler.c api_bridge.c
OBJECTS = $(SOURCES:.c=.o)
HEADERS = flight.h queue.h scheduler.h api_bridge.h

# Colors for output (optional)
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[0;33m
BLUE = \033[0;34m
NC = \033[0m # No Color

# Default target
all: banner $(TARGET) setup
	@echo ""
	@echo "$(GREEN)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(GREEN)â•‘         BUILD COMPLETED SUCCESSFULLY! âœ…                  â•‘$(NC)"
	@echo "$(GREEN)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(BLUE)ğŸ“‚ Project structure ready:$(NC)"
	@echo "   âœ… Backend compiled: ./$(TARGET)"
	@echo "   âœ… Data directory: ./data/"
	@echo "   âœ… Frontend ready: ./airport_integrated.html"
	@echo ""
	@echo "$(YELLOW)ğŸš€ To run:$(NC)"
	@echo "   1. Terminal: ./$(TARGET)"
	@echo "   2. Browser: Open airport_integrated.html"
	@echo "   3. Select menu option 11 for Web Dashboard Mode"
	@echo ""

# Banner
banner:
	@echo "$(BLUE)"
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘   Airport Runway Scheduling System - Integrated Build    â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "$(NC)"

# Link object files to create executable
$(TARGET): $(OBJECTS)
	@echo "$(YELLOW)ğŸ”— Linking objects...$(NC)"
	$(CC) $(CFLAGS) -o $(TARGET) $(OBJECTS)
	@echo "$(GREEN)âœ… Executable created: $(TARGET)$(NC)"

# Compile source files to object files
%.o: %.c $(HEADERS)
	@echo "$(YELLOW)ğŸ”¨ Compiling $<...$(NC)"
	$(CC) $(CFLAGS) -c $< -o $@

# Setup directories and check files
setup:
	@echo ""
	@echo "$(YELLOW)ğŸ“‚ Setting up directories...$(NC)"
	@mkdir -p data
	@echo "$(GREEN)âœ… Data directory created$(NC)"
	@if [ -f airport_integrated.html ]; then \
		echo "$(GREEN)âœ… Frontend file found$(NC)"; \
	else \
		echo "$(RED)âš ï¸  Warning: airport_integrated.html not found!$(NC)"; \
	fi

# Clean up compiled files
clean:
	@echo "$(YELLOW)ğŸ§¹ Cleaning up...$(NC)"
	rm -f $(OBJECTS) $(TARGET)
	@echo "$(GREEN)âœ… Cleanup complete$(NC)"

# Deep clean (includes data directory)
deepclean: clean
	@echo "$(YELLOW)ğŸ§¹ Deep cleaning (removing data files)...$(NC)"
	rm -rf data/
	@echo "$(GREEN)âœ… Deep cleanup complete$(NC)"

# Run the program
run: $(TARGET)
	@echo "$(GREEN)â–¶ï¸  Starting Airport Runway System...$(NC)"
	@echo ""
	./$(TARGET)

# Quick demo setup
demo: all
	@echo ""
	@echo "$(GREEN)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(GREEN)â•‘              DEMO MODE ACTIVATED ğŸ¬                       â•‘$(NC)"
	@echo "$(GREEN)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(BLUE)Demo setup complete! Follow these steps:$(NC)"
	@echo ""
	@echo "$(YELLOW)Terminal (this window):$(NC)"
	@echo "  1. Run: ./$(TARGET)"
	@echo "  2. Choose algorithm: 2 (Priority)"
	@echo "  3. Add sample flights: y"
	@echo "  4. Select: 11 (Web Dashboard Mode)"
	@echo "  5. Press 's' to start simulation"
	@echo ""
	@echo "$(YELLOW)Browser (new window):$(NC)"
	@echo "  1. Open: airport_integrated.html"
	@echo "  2. Click: 'Start Auto-Refresh'"
	@echo "  3. Watch live updates! âœ¨"
	@echo ""

# Test compilation only
test:
	@echo "$(YELLOW)ğŸ§ª Testing compilation...$(NC)"
	$(CC) $(CFLAGS) -c $(SOURCES)
	@echo "$(GREEN)âœ… All files compile successfully$(NC)"
	@rm -f $(OBJECTS)

# Check for required files
check:
	@echo "$(BLUE)ğŸ“‹ Checking project files...$(NC)"
	@echo ""
	@echo "$(YELLOW)Header files:$(NC)"
	@for file in $(HEADERS); do \
		if [ -f $$file ]; then \
			echo "  $(GREEN)âœ… $$file$(NC)"; \
		else \
			echo "  $(RED)âŒ $$file (missing!)$(NC)"; \
		fi \
	done
	@echo ""
	@echo "$(YELLOW)Source files:$(NC)"
	@for file in $(SOURCES); do \
		if [ -f $$file ]; then \
			echo "  $(GREEN)âœ… $$file$(NC)"; \
		else \
			echo "  $(RED)âŒ $$file (missing!)$(NC)"; \
		fi \
	done
	@echo ""
	@echo "$(YELLOW)Frontend:$(NC)"
	@if [ -f airport_integrated.html ]; then \
		echo "  $(GREEN)âœ… airport_integrated.html$(NC)"; \
	else \
		echo "  $(RED)âŒ airport_integrated.html (missing!)$(NC)"; \
	fi
	@echo ""

# Rebuild everything
rebuild: clean all

# Install (copy to a standard location - optional)
install: $(TARGET)
	@echo "$(YELLOW)ğŸ“¦ Installing to ~/airport-system/$(NC)"
	@mkdir -p ~/airport-system
	@cp $(TARGET) ~/airport-system/
	@cp airport_integrated.html ~/airport-system/ 2>/dev/null || true
	@cp -r data ~/airport-system/ 2>/dev/null || true
	@echo "$(GREEN)âœ… Installed to ~/airport-system/$(NC)"

# Show help
help:
	@echo "$(BLUE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(BLUE)â•‘     Airport Runway System - Makefile Commands            â•‘$(NC)"
	@echo "$(BLUE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(YELLOW)Build Commands:$(NC)"
	@echo "  make           - Build the complete system"
	@echo "  make all       - Same as 'make'"
	@echo "  make clean     - Remove compiled files"
	@echo "  make deepclean - Remove compiled files and data"
	@echo "  make rebuild   - Clean and build from scratch"
	@echo "  make test      - Test if all files compile"
	@echo ""
	@echo "$(YELLOW)Run Commands:$(NC)"
	@echo "  make run       - Compile and run the program"
	@echo "  make demo      - Setup for demo presentation"
	@echo ""
	@echo "$(YELLOW)Utility Commands:$(NC)"
	@echo "  make check     - Check if all required files exist"
	@echo "  make install   - Install to ~/airport-system/"
	@echo "  make help      - Show this help message"
	@echo ""
	@echo "$(GREEN)Quick Start:$(NC)"
	@echo "  make demo      - Best for first-time setup"
	@echo ""

# Show project info
info:
	@echo "$(BLUE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(BLUE)â•‘          Project Information                              â•‘$(NC)"
	@echo "$(BLUE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(YELLOW)Project:$(NC) Airport Runway Scheduling System"
	@echo "$(YELLOW)Version:$(NC) 1.0 (Integrated)"
	@echo "$(YELLOW)Compiler:$(NC) $(CC)"
	@echo "$(YELLOW)Flags:$(NC) $(CFLAGS)"
	@echo ""
	@echo "$(YELLOW)Components:$(NC)"
	@echo "  â€¢ C Backend (5 modules)"
	@echo "  â€¢ Web Frontend (HTML/JS)"
	@echo "  â€¢ JSON Integration Bridge"
	@echo "  â€¢ 4 Scheduling Algorithms"
	@echo "  â€¢ Real-time Synchronization"
	@echo ""
	@echo "$(YELLOW)Features:$(NC)"
	@echo "  âœ… Multiple data structures"
	@echo "  âœ… Priority queue (heap)"
	@echo "  âœ… Linked lists"
	@echo "  âœ… Queue operations"
	@echo "  âœ… Real-time visualization"
	@echo "  âœ… JSON export"
	@echo "  âœ… Web integration"
	@echo ""

# Phony targets
.PHONY: all banner setup clean deepclean run demo test check rebuild install help info

# Default goal
.DEFAULT_GOAL := all
